<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Juhong Park</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Juhong Park">
<meta property="og:url" content="http://blog.jpark.me/index.html">
<meta property="og:site_name" content="Juhong Park">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Juhong Park">
  
    <link rel="alternate" href="/atom.xml" title="Juhong Park" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-100468480-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Juhong Park</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Zoeken"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.jpark.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-jupyter-notebook-pep8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/24/jupyter-notebook-pep8/" class="article-date">
  <time datetime="2017-06-24T05:08:42.000Z" itemprop="datePublished">2017-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/24/jupyter-notebook-pep8/">Jupyter Notebook 에 PEP8 적용하기</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- toc -->
<ul>
<li><a href="#1-pep8">1. PEP8</a></li>
<li><a href="#2-autopep8">2. Autopep8</a></li>
<li><a href="#3-jupyter-notebook-에-autopep8-붙이기">3. Jupyter Notebook 에 Autopep8 붙이기</a></li>
</ul>
<!-- tocstop -->
<p>Python 으로 데이터 분석을 할때 <a href="http://jupyter.org/" target="_blank" rel="external">Jupyter Notebook</a> 을 사용하면 공유나 문서화에 아주 큰 장점이 있습니다.</p>
<p>그런데 Jupyter Notebook 을 사용하여 여러사람들과 작업하다보니 Coding Style 서로 조금씩 달라서 PEP8 로 천하통일을 하려고 했습니다.</p>
<p><img src="http://newsmanager2.etomato.com/userfiles/image/%EC%B5%9C%EC%A4%80%ED%98%B8/1222_roll.png" alt="PEP8 로 Coding Style 천하통일하기"></p>
<p>그래서 간단하게 PEP8 을 Jupyter Notebook 에 붙이는 방법에 대해 살펴보고자합니다.</p>
<hr>
<h1 id="1-pep8"><a href="#1-PEP8" class="headerlink" title="1. PEP8"></a>1. PEP8</h1><p>우선 <a href="https://www.python.org/dev/peps/pep-0008/" target="_blank" rel="external">PEP8</a> 이 뭔가 살펴보겠습니다.</p>
<p>한국에서도 사람마다 말하는 방식이 다양합니다. 사람마다 주로 사용하는 단어가 있기도하고 연령, 지역별로 말하는 방식이 다르기도 합니다. 심한 방언의 경우 이해하기 어려운 경우도 있습니다.</p>
<p><img src="http://ppss.kr/wp-content/uploads/2016/07/%ED%99%8D%EC%A4%80%ED%91%9C_%EB%A7%89%EB%A7%90_%EB%85%BC%EB%9E%80_%EB%8F%84%EC%9D%98%EC%9B%90_%EC%93%B0%EB%A0%88%EA%B8%B0_%EA%B0%9C_7.jpg" alt="세상에는 이런 방식으로 말하는 사람도 있습니다"></p>
<p>그래서 원활한 의사소통을 위해 공식적으로 표준 언어규범을 정하는데 바로 표준어입니다. 한국어에도 물론 표준어가 존재하고 아래와 같이 규정되어 있습니다.</p>
<blockquote>
<p><strong>대한민국 표준어</strong><br>표준어는 교양 있는 사람들이 두루 쓰는 현대 서울말로 정함을 원칙으로 한다. </p>
</blockquote>
<p>저는 이 규정을 볼때마다 <code>내가 과연 교양이 있는 사람인가...</code> 에 대한 고민에 빠지곤 합니다.</p>
<p>여튼 이런 표준어처럼 Python 의 세상에도 공식적으로 정한 표준 언어규범이 있는데, 그게 바로 PEP8 입니다. 프로그래머 마다의 습관이 있으니 실제 Coding Style 은 다를 수 있지만, 공동작업을 하거나 외부에 코드를 공유할 경우에는 이런 규칙이 정해져 있으면 편하게 사용할 수 있습니다.</p>
<hr>
<h1 id="2-autopep8"><a href="#2-Autopep8" class="headerlink" title="2. Autopep8"></a>2. Autopep8</h1><p>그렇지만 우리가 표준어를 사용하기 위해, 표준어 규칙을 외우고 다니려면 참 피곤할 것 같습니다. 물론 중요한 표현이나 맞춤법은 숙지하고 있어야하지만 아나운서나 기자가 아닌 이상 완벽하게 알고 있기는 어렵습니다.</p>
<p>PEP8 도 마찬가지입니다. 프로그래머들이 본능적으로 일부 숙지하고 있지만 모든 규정을 완벽하게 외우기는 거의 불가능합니다.</p>
<p>이런 어려움을 돕기위해 자동으로 PEP8 을 적용해주는 착한 친구가 있으니 바로 <a href="https://pypi.python.org/pypi/autopep8" target="_blank" rel="external">Autopep8</a> 입니다. pip 로 설치가 가능하고 conda 로도 설치가 가능합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># pip 로 설치</span></div><div class="line">$ pip install autopep8</div></pre></td></tr></table></figure>
<p>또는<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># conda 로 설치</span></div><div class="line">$ conda install autopep8</div></pre></td></tr></table></figure></p>
<p>간단하게 사용방법을 살펴보겠습니다.</p>
<p>우선 import 해서 python code 안에서 사용 할 수 있습니다.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> autopep8</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>autopep8.fix_code(<span class="string">"x=       1"</span>)</div><div class="line"><span class="string">'x = 1\n'</span></div></pre></td></tr></table></figure></p>
<p>혹은 파일에 바로 적용할 수도 있습니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="string">"x=       1"</span> &gt; bad.py</div><div class="line">$ autopep8 bad.py</div><div class="line">x = 1</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="3-jupyter-notebook-에-autopep8-붙이기"><a href="#3-Jupyter-Notebook-에-Autopep8-붙이기" class="headerlink" title="3. Jupyter Notebook 에 Autopep8 붙이기"></a>3. Jupyter Notebook 에 Autopep8 붙이기</h1><p>이제 여기서부터 제가 이 포스트를 작성한 이유, Jupyter Notebook 에 Autopep8 을 붙이는 방법에 대해 살펴보겠습니다.</p>
<p>IPython 의 공식 <a href="https://github.com/ipython/ipython/wiki/Extensions-Index#pep8" target="_blank" rel="external">github wiki</a> 를 보면  <code>%%pep8</code>  라는 cell magic 이 나옵니다. 그리고 친절하게 <a href="http://nbviewer.jupyter.org/github/SiggyF/notebooks/blob/master/styleguide.ipynb" target="_blank" rel="external">예제 Notebook</a> 도 작성되어 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">%install_ext https://raw.githubusercontent.com/SiggyF/notebooks/master/pep8_magic.py</div><div class="line">%load_ext pep8_magic</div></pre></td></tr></table></figure>
<p>그런데 문제는, 여기서 사용한 <code>install_ext</code> 가 IPython 4.0 부터 Deprecated 되었고 5.0 부터는 아예 삭제되었습니다. 관심이 있으신분은 <a href="https://github.com/ipython/ipython/issues/8634" target="_blank" rel="external">#8634</a> 을 참고하시면 됩니다.</p>
<p>그래서 다른 방법을 찾아보던 중, <a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions" target="_blank" rel="external">jupyter_contrib_nbextensions</a> 라는 좋은 친구를 발견하게 되었습니다.</p>
<p>아래와 같이 Jupyter Notebook 에서 nbextension 을 직접 관리 할 수 있게 도와줍니다. Autopep8 도 nbextension 형태로 제공되어 있어서 jupyter_contrib_nbextensions 를 사용하면 간편하게 Autopep8 을 붙일 수 있습니다.</p>
<p><img src="https://raw.githubusercontent.com/Jupyter-contrib/jupyter_nbextensions_configurator/master/src/jupyter_nbextensions_configurator/static/nbextensions_configurator/icon.png" alt="jupyter_contrib_nbextensions 의 우월한 관리화면"></p>
<p>설치 방법은 pip 와 conda 모두 지원하고 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># pip 로 설치</span></div><div class="line">$ pip install jupyter_contrib_nbextensions</div></pre></td></tr></table></figure>
<p>또는<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># conda 로 설치</span></div><div class="line">$ conda install -c conda-forge jupyter_contrib_nbextensions</div></pre></td></tr></table></figure></p>
<p>그 다음에는 jupyter_contrib_nbextensions 에 필요한 Javascript 와 CSS 을 가져옵니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jupyter contrib nbextension install</div></pre></td></tr></table></figure></p>
<p>마지막으로 Autopep8 을 enable 해보겠습니다. 여기서 당연한 이야기지만, Autopep8 를 위에서 설명한 방식대로 미리 설치두셔야 합니다.</p>
<p>Enable 은 간단하게 아래와 같이 NBextentions 에서 Autopep8 를 체크해주시면 됩니다.</p>
<p><img src="/images/autopep8_enable.png" alt="Autopep8 enable"></p>
<p>단, 여기서 중요한 것은 위 스크린샷의 <code>compatibility: Jupyter (4.x)</code> 에서 보시는 것처럼 Jupyper 의 버전을 4.x 대로 맞춰야한다는 것입니다.</p>
<p>저의 경우 이미 5.x 를 사용하고 있었기 때문에 Enable 할 수 없었습니다. 그러나 특별히 5.x 의 기능 중에 당장 필요한 것이 없어서 4.x 로 버전을 내려왔습니다. 저는 4.3.0 버전으로 변경하였습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># pip 로 설치</span></div><div class="line">$ pip install jupyter_core==4.3.0</div></pre></td></tr></table></figure>
<p>또는<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># conda 로 설치</span></div><div class="line">$ conda install jupyter_core==4.3.0</div></pre></td></tr></table></figure></p>
<p>이제 여기까지 되시면 Jupyter Notebook 에서 Autopep8 를 사용하실 수 있습니다.</p>
<p>단축키를 사용하여 Autopep8 을 적용하는데 NBextentions 설정창에서 단축키를 확인, 변경할 수 있습니다.</p>
<p>제가 사용하는 Mac 기준으로는 <code>⌥A</code> 를 하시면 선택한 Cell 만, <code>⌥⇧A</code> 를 하시면 전체 Cell 에서 적용되니 참고하시기 바랍니다.</p>
<p>포스트를 참고해서 Jupyter Notebook 에 PEP8 을 적용해보시고 궁금하신 점이 있으시면 <a href="mailto:JPark@JPark.me" target="_blank" rel="external">JPark@JPark.me</a> 로 언제든지 편하게 연락주시기 바랍니다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jpark.me/2017/06/24/jupyter-notebook-pep8/" data-id="cj4au1p470001ilxutwi3h8g7" class="article-share-link">Delen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-caffe-mnist-tutorial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/04/caffe-mnist-tutorial/" class="article-date">
  <time datetime="2017-06-04T06:35:42.000Z" itemprop="datePublished">2017-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/04/caffe-mnist-tutorial/">Caffe 로 해보는 MNIST 튜토리얼</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- toc -->
<ul>
<li><a href="#1-docker-로-caffe-설치하기">1. Docker 로 Caffe 설치하기</a><ul>
<li><a href="#caffe-docker-가져오기">Caffe Docker 가져오기</a></li>
<li><a href="#caffe-docker-에-vi-설치하기">Caffe Docker 에 vi 설치하기</a></li>
</ul>
</li>
<li><a href="#2-caffe-로-mnist-모델-만들기">2. Caffe 로 MNIST 모델 만들기</a><ul>
<li><a href="#mnist-data-준비하기">MNIST Data 준비하기</a></li>
<li><a href="#caffe-학습-설정-변경하기">Caffe 학습 설정 변경하기</a></li>
<li><a href="#caffe-모델-학습하기">Caffe 모델 학습하기</a></li>
<li><a href="#caffe-모델-사용하기">Caffe 모델 사용하기</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<p><a href="http://caffe.berkeleyvision.org/" target="_blank" rel="external">Caffe</a> 로 간단한 <a href="https://www.quora.com/What-is-MNIST" target="_blank" rel="external">MNIST</a> 튜토리얼을 해보겠습니다.</p>
<p>MNIST 는 아래와 같이 숫자를 손글씨로 쓴 데이터셋입니다. 튜토리얼에서는 이런 손글씨에서 숫자를 자동으로 인식하는 딥러닝 모델을 구현하려고 합니다.<br><img src="https://qph.ec.quoracdn.net/main-qimg-d01751bdf7dab3d9a5949f226a35b7ba.webp" alt="MNIST Example"></p>
<p>Caffe 는 UC Berkeley BVLC 에서 개발된 Deep Learning Framework 입니다. 오픈소스로 개발되었고 필요하시면 언제든지 <a href="https://github.com/BVLC/caffe/" target="_blank" rel="external">github</a> 을 통해 코드를 확인하실 수 있습니다.</p>
<p>Caffe 에는 여러가지 특징이 있습니다. 그 중에서 이번 튜토리얼로 직접 체험하실 수 있는 <strong>Expressive Architecture</strong> 에 대해 간단히 소개하겠습니다.</p>
<ul>
<li>Expressive architecture<br>Caffe 는 딥러닝 모델 구현과 최적화가 Configuration 만으로 가능합니다. 복잡한 코딩 없이 설정 변경만으로 딥러닝 모델을 수정할 수 있고, GPU 를 사용하여 모델을 학습하는 것 역시 간단한 설정 변경으로 가능합니다.</li>
</ul>
<p><a href="http://caffe.berkeleyvision.org/installation.html" target="_blank" rel="external">Caffe Installation</a> 을 보면 다양한 설치 방법이 있습니다. 여기서 가장 간단하고 사용할 수 있는 <a href="https://www.docker.com/" target="_blank" rel="external">Docker</a> 를 사용해서 튜토리얼을 진행해보겠습니다. Docker 는 개발자의 시간과 삶을 연장해주는 좋은 친구이니, 처음 접하시는 분은 <a href="https://docs.docker.com/engine/installation/" target="_blank" rel="external">Docker Installation</a> 를 참고해서 이번 기회에 설치해 보시기 바랍니다.</p>
<hr>
<h1 id="1-docker-로-caffe-설치하기"><a href="#1-Docker-로-Caffe-설치하기" class="headerlink" title="1. Docker 로 Caffe 설치하기"></a>1. Docker 로 Caffe 설치하기</h1><hr>
<h2 id="caffe-docker-가져오기"><a href="#Caffe-Docker-가져오기" class="headerlink" title="Caffe Docker 가져오기"></a>Caffe Docker 가져오기</h2><p>이제 본격적으로 Docker 를 활용하여 Caffe 를 설치해보겠습니다. Caffe 의 Docker 정보가 궁금하신 분은 <a href="https://docs.docker.com/engine/installation/" target="_blank" rel="external">Docker Hub</a> 를 참고하시길 바랍니다.</p>
<p>Caffe 의 Docker 는 CPU, GPU 2가지 버전이 있습니다. 이번에는 간단히 Caffe 를 접하는 것이 목표이므로 CPU 를 사용해서 진행해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker pull bvlc/caffe:cpu</div></pre></td></tr></table></figure>
<p>정상적으로 Pull 이 되었는지 확인하기 위해 Caffe 의 버전을 호출해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker run -ti bvlc/caffe:cpu caffe --version</div><div class="line">caffe version 1.0.0</div></pre></td></tr></table></figure>
<p>위와 같이 버전 정보가 나오면 정상적으로 설치된 것 입니다.</p>
<p>이제 아래의 명령을 통해 Docker 를 실행해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -ti bvlc/caffe:cpu</div></pre></td></tr></table></figure>
<hr>
<h2 id="caffe-docker-에-vi-설치하기"><a href="#Caffe-Docker-에-vi-설치하기" class="headerlink" title="Caffe Docker 에 vi 설치하기"></a>Caffe Docker 에 vi 설치하기</h2><p>본격적으로 Caffe 를 사용하기전에 간단하게 셋팅을 먼저해보겠습니다.</p>
<p>앞서 말씀드린 것처럼, Caffe 는 설정 파일을 변경해서 모델 수정이나 최적화를 할 수 있습니다. 그런데 위에서 설치한 Docker 는 매우 경량화된 Ubuntu 를 사용하기때문에 <code>vi</code>, <code>vim</code>, <code>nano</code> 등이 설치되어 있지 않습니다. 이번 튜토리얼에서는 직접 Docker 내부의 값을 수정하고 살펴볼 것이므로 <code>vi</code> 를 미리 설치하도록 하겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ apt-get update</div><div class="line">$ apt-get install -y vim</div></pre></td></tr></table></figure>
<hr>
<h1 id="2-caffe-로-mnist-모델-만들기"><a href="#2-Caffe-로-MNIST-모델-만들기" class="headerlink" title="2. Caffe 로 MNIST 모델 만들기"></a>2. Caffe 로 MNIST 모델 만들기</h1><hr>
<h2 id="mnist-data-준비하기"><a href="#MNIST-Data-준비하기" class="headerlink" title="MNIST Data 준비하기"></a>MNIST Data 준비하기</h2><p>이제 Docker 는 모두 셋팅되었으니 MNIST Data 를 준비해보겠습니다.</p>
<p>우선 Docker 에서 Caffe 가 설치된 위치로 이동해보겠습니다. 참고로 아래의 진행되는 모든 명령어는 <code>CAFFE_ROOT</code> 에서 실행하셔야 정상적으로 작동됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> <span class="variable">$CAFFE_ROOT</span></div></pre></td></tr></table></figure>
<p>Caffe 가 설치된 위치에 여러가지 파일이 있는 것을 확인하실 수 있습니다. 이 중에서 중요한 것만 설명해보겠습니다.</p>
<ul>
<li>data: 데이터가 저장된 폴더</li>
<li>examples: 예제 프로그램이 저장된 폴더</li>
<li>build: Caffe 실행 파일이 저장된 폴더</li>
</ul>
<p>우리는 examles 중에서도 MNIST 를 실행하는 것이 목표입니다.</p>
<p>그러려면 우선 Data 를 가져와야겠죠? 아래의 명령어를 통해 데이터를 가져옵시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./data/mnist/get_mnist.sh</div></pre></td></tr></table></figure>
<p>data 폴더를 확인해보면 데이터가 다운된 것을 확인 할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ls ./data/mnist</div><div class="line">get_mnist.sh  t10k-images-idx3-ubyte  t10k-labels-idx1-ubyte  train-images-idx3-ubyte  train-labels-idx1-ubyte</div></pre></td></tr></table></figure>
<p>이제 다운 받은 데이터를 활용해서 Caffe 에 입력하는 데이터 형태로 변환하겠습니다. 이미 예제 프로그램이 작성되어 있으므로 실행해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./examples/mnist/create_mnist.sh</div></pre></td></tr></table></figure>
<p>변환된 데이터는 <a href="http://www.lmdb.tech/doc/index.html" target="_blank" rel="external">LMDB</a> 형식으로 변환되어 저장됩니다. 변환된 데이터를 확인해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ls examples/mnist/mnist_*_lmdb</div><div class="line">examples/mnist/mnist_test_lmdb:</div><div class="line">data.mdb  lock.mdb</div><div class="line"></div><div class="line">examples/mnist/mnist_train_lmdb:</div><div class="line">data.mdb  lock.mdb</div></pre></td></tr></table></figure>
<hr>
<h2 id="caffe-학습-설정-변경하기"><a href="#Caffe-학습-설정-변경하기" class="headerlink" title="Caffe 학습 설정 변경하기"></a>Caffe 학습 설정 변경하기</h2><p>이제 바로 Caffe 로 모델을 돌려보면 좋겠지만, 몇가지 수정해야 하는 사항이 있습니다.</p>
<p>간단히 튜토리얼만 돌려보고 싶지만, 실제로는 튜토리얼만 학습하는 것에도 비교적 오랜시간이 소요됩니다. 그래서 설정 파일을 공부할겸, 학습이 일찍 끝나도록 수정해보겠습니다.</p>
<p>우리가 학습에 사용하는 모델은 <a href="http://yann.lecun.com/exdb/lenet/" target="_blank" rel="external">Lenet</a> 입니다. 우선 MNSIT 예제 파일 내용을 확인해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ vi examples/mnist/train_lenet.sh</div><div class="line"></div><div class="line"><span class="meta">#!/usr/bin/env sh</span></div><div class="line"><span class="built_in">set</span> -e</div><div class="line"></div><div class="line">./build/tools/caffe train --solver=examples/mnist/lenet_solver.prototxt <span class="variable">$@</span></div></pre></td></tr></table></figure>
<p>아래쪽의 명령어를 해석해보면, <code>./build/tools/caffe</code> 로 <code>train</code> 하는데 <code>--solver=examples/mnist/lenet_solver.prototxt</code> 를 사용하겠다는 것입니다.</p>
<p>여기서 <code>--solver</code> 를 어떻게 설정하느냐가 가장 중요한 포인트입니다. 그럼 <code>lenet_solver.prototxt</code> 파일을 직접 열어서 확인해보겠습니다. 파일이 너무 길어져서 주석은 제거했습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ vi examples/mnist/lenet_solver.prototxt</div><div class="line"></div><div class="line">net: <span class="string">"examples/mnist/lenet_train_test.prototxt"</span></div><div class="line">test_iter: 100</div><div class="line">test_interval: 500</div><div class="line">base_lr: 0.01</div><div class="line">momentum: 0.9</div><div class="line">weight_decay: 0.0005</div><div class="line">lr_policy: <span class="string">"inv"</span></div><div class="line">gamma: 0.0001</div><div class="line">power: 0.75</div><div class="line">display: 100</div><div class="line">max_iter: 10000</div><div class="line">snapshot: 5000</div><div class="line">snapshot_prefix: <span class="string">"examples/mnist/lenet"</span></div><div class="line">solver_mode: GPU</div></pre></td></tr></table></figure>
<p>여기서 중요한 설정 값 몇개를 확인해보겠습니다.</p>
<ul>
<li>net: 실제 모델이 정의된 설정 파일입니다. 여기서 나온 <code>lenet_train_test.prototxt</code> 도 직접 열어서 확인해보시기를 권장합니다. 간단히 설명하자면 <code>Type</code> 은 해당 Layer 를 정의하는 것이고, <code>bottom</code> 은 Layer 의 입력층, <code>top</code> 은 Layer 의 출력층을 정의하는 것입니다. 자세한 설명은 이번 튜토리얼 범위를 벗어나게 되므로 <a href="http://caffe.berkeleyvision.org/doxygen/annotated.html" target="_blank" rel="external">API Documentation</a> 를 확인해주시기 바랍니다.</li>
<li>test_iter: test 를 위해 몇번의 Iteration 를 돌 것인지에 설정합니다.</li>
<li>test_interval: Test 를 실행하는 간격을 설정합니다.</li>
<li>base_lr: <a href="https://www.quora.com/What-is-the-learning-rate-in-neural-networks" target="_blank" rel="external">Learning Rate</a> 의 초기값을 설정합니다. Learning Rate 는 학습 속도를 정의하는 것인데, 값이 너무 작으면 학습속도가 느려지게되고 이 값이 너무 크면 <a href="https://en.wikipedia.org/wiki/Overfitting" target="_blank" rel="external">Overfitting</a> 이 될 수 있습니다.</li>
<li>display: 학습 도중에 몇번의 Iteration 마다 중간 결과를 보여줄 것인지 설정합니다.</li>
<li>max_iter: 학습을 실행하는 최대 Iteration 을 설정합니다.</li>
<li>snapshot: 학습 도중에 특정 Iteration 마다 모델의 중간 결과를 저장 할 수 있습니다. 이 설정은 몇번째 Iteration 마다 중간 결과를 저장할 것인지 설정합니다.</li>
<li>solver_mode: 모델을 CPU, GPU 중에서 어떤 것으로 학습할지를 설정합니다. 이처럼 Caffe 는 CPU, GPU 사이의 설정 변경이 매우 간단합니다.</li>
</ul>
<p>저는 앞서 말씀드린것처럼, 튜토리얼의 학습 시간을 단축하고 CPU 를 사용하기 위해 아래와 같이 설정을 변경하였습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">test_iter: 50</div><div class="line">test_interval: 200</div><div class="line">max_iter: 1000</div><div class="line">snapshot: 200</div><div class="line">solver_mode: CPU</div></pre></td></tr></table></figure>
<hr>
<h2 id="caffe-모델-학습하기"><a href="#Caffe-모델-학습하기" class="headerlink" title="Caffe 모델 학습하기"></a>Caffe 모델 학습하기</h2><p>이제 드디어 Caffe 로 모델을 학습해보겠습니다! 간단히 아래와 같이 실행합니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./examples/mnist/train_lenet.sh</div></pre></td></tr></table></figure></p>
<p>학습을 시작하면 아래와 같이 로그가 출력됩니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">I0604 03:46:11.742939   465 solver.cpp:330] Iteration 200, Testing net (<span class="comment">#0)</span></div><div class="line">I0604 03:46:14.321601   468 data_layer.cpp:73] Restarting data prefetching from start.</div><div class="line">I0604 03:46:14.537012   465 solver.cpp:397]     Test net output <span class="comment">#0: accuracy = 0.946</span></div><div class="line">I0604 03:46:14.537225   465 solver.cpp:397]     Test net output <span class="comment">#1: loss = 0.180661 (* 1 = 0.180661 loss)</span></div><div class="line">I0604 03:46:14.620964   465 solver.cpp:218] Iteration 200 (8.8098 iter/s, 11.351s/100 iters), loss = 0.136332</div><div class="line">I0604 03:46:14.621160   465 solver.cpp:237]     Train net output <span class="comment">#0: loss = 0.136332 (* 1 = 0.136332 loss)</span></div><div class="line">I0604 03:46:14.621219   465 sgd_solver.cpp:105] Iteration 200, lr = 0.00985258</div></pre></td></tr></table></figure></p>
<p>이 중에서 중요한 부분을 살펴보겠습니다.</p>
<ul>
<li>Iteration: 학습 중인 Iteration 횟수를 보여줍니다</li>
<li>Train net output: Train Data 의 모델 학습 결과를 보여줍니다.</li>
<li>Test net output: Test Data 의 모델 학습 결과를 보여줍니다.</li>
<li>accuracy: Accuracy 값을 보여줍니다.</li>
<li>loss: Loss 값을 보여줍니다</li>
<li>lr: 현재 학습 중인 Learning Rate 를 보여줍니다.</li>
</ul>
<hr>
<h2 id="caffe-모델-사용하기"><a href="#Caffe-모델-사용하기" class="headerlink" title="Caffe 모델 사용하기"></a>Caffe 모델 사용하기</h2><p>위에서 학습한 모델을 확인해보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ ls examples/mnist/lenet_iter_*.caffemodel</div><div class="line">examples/mnist/lenet_iter_1000.caffemodel  examples/mnist/lenet_iter_400.caffemodel  examples/mnist/lenet_iter_800.caffemodel</div><div class="line">examples/mnist/lenet_iter_200.caffemodel   examples/mnist/lenet_iter_600.caffemodel</div></pre></td></tr></table></figure>
<p><code>lenet_iter_200.caffemodel</code> 부터 <code>lenet_iter_1000.caffemodel</code> 까지 5개의 모델이 만들어진 것을 확인할 수 있습니다. 이것은 위에서 설정한 <code>max_iter: 1000</code>  와 <code>snapshot: 200</code> 에 의한 결과인데, 1000번의 Iteration 도중 200번째 Iteration 마다 학습 모델을 저장한 것입니다.</p>
<p>그럼 이제 만들어진 학습 모델를 사용해서 실제 MNIST 의 손글씨를 숫자로 인식하도록 해보겠습니다. 아래와 같이 명령어를 입력하면 모델이 인식한 값과 실제 정답을 비교한 뒤 결과를 알려줍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ./build/tools/caffe <span class="built_in">test</span> -model ./examples/mnist/lenet_train_test.prototxt -weights ./examples/mnist/lenet_iter_200.caffemodel</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">I0604 03:51:57.976830   473 caffe.cpp:330] accuracy = 0.8978</div><div class="line">I0604 03:51:57.977108   473 caffe.cpp:330] loss = 0.332346 (* 1 = 0.332346 loss)</div></pre></td></tr></table></figure>
<p>위의 명령어를 간단하게 살펴보면 <code>./build/tools/caffe</code> 로 <code>test</code> 하는데 <code>-model ./examples/mnist/lenet_train_test.prototxt</code> 를 모델로 사용하고 <code>-weights ./examples/mnist/lenet_iter_200.caffemodel</code> 의 학습 결과를 적용하겠다는 것입니다.</p>
<p><code>lenet_iter_200.caffemodel</code> 는 200번째 Iteration 이후의 결과인데 <code>accuracy = 0.8978</code> 입니다. 나쁜 수치는 아닌 것 같지만 아쉬운 결과입니다.</p>
<p>그럼 이보다 5배 많이 학습한 <code>lenet_iter_1000.caffemodel</code> 은 어떨까요?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ./build/tools/caffe <span class="built_in">test</span> -model ./examples/mnist/lenet_train_test.prototxt -weights ./examples/mnist/lenet_iter_1000.caffemodel</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">I0604 03:57:36.841078   476 caffe.cpp:330] accuracy = 0.9746</div><div class="line">I0604 03:57:36.841120   476 caffe.cpp:330] loss = 0.0788368 (* 1 = 0.0788368 loss)</div></pre></td></tr></table></figure>
<p><code>lenet_iter_1000.caffemodel</code> 은 <code>accuracy = 0.9746</code> 로 <code>lenet_iter_200.caffemodel</code> 보다 훨씬 좋은 성능을 보여줍니다! 물론 모델에 따라 항상 그런것은 아니지만, 대체로 Iteration 이 올라가면 어느정도 성능이 향상되는 것을 확인 할 수 있습니다.</p>
<hr>
<p>그럼 여기까지 Caffe 를 사용해봤습니다. Caffe 는 간단한 설정파일 변경만으로도 Model 을 구현할 수 있다는 장점이 있습니다. MNIST 튜토리얼을 해보시고 궁금하신 점이 있으시면 <a href="mailto:JPark@JPark.me" target="_blank" rel="external">JPark@JPark.me</a> 로 언제든지 편하게 연락주시기 바랍니다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.jpark.me/2017/06/04/caffe-mnist-tutorial/" data-id="cj4au1p420000ilxus51duvnd" class="article-share-link">Delen</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archieven</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recente berichten</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/24/jupyter-notebook-pep8/">Jupyter Notebook 에 PEP8 적용하기</a>
          </li>
        
          <li>
            <a href="/2017/06/04/caffe-mnist-tutorial/">Caffe 로 해보는 MNIST 튜토리얼</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Juhong Park<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>